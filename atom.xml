<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
 
 <title>Renren</title>
 <link href="http://renren.github.com/atom.xml" rel="self"/>
 <link href="http://renren.github.com"/>
 <updated>2012-12-31T01:57:05+08:00</updated>
 <id>http://renren.github.com</id>
 <author>
   <name>Renren Inc.</name>
   <email>liulantao@gmail.com</email>
 </author>

 
 <entry>
   <title>TFS配置文件</title>
   <link href="http://renren.github.com/TFS/2012/12/26/tfs-configuration"/>
   <updated>2012-12-26T00:00:00+08:00</updated>
   <id>http://renren.github.com/TFS/2012/12/26/tfs-configuration</id>
   <content type="html">&lt;pre&gt;&lt;code&gt;[public]&lt;/code&gt;&lt;/pre&gt;
&lt;br /&gt;
&lt;p&gt;日志级别，&lt;strong&gt;可选设置&lt;/strong&gt;，默认为&lt;strong&gt;debug&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;线上建议设置为INFO，调试时设为DEBUG，有效值是&amp;#8221;ERROR&amp;#8221;,&amp;#8221;WARN&amp;#8221;,&amp;#8221;INFO&amp;#8221;,&amp;#8221;DEBUG&amp;#8221;，不区分大小写&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;log_level = INFO [ ERROR|WARN|INFO|DEBUG ]&lt;/code&gt;&lt;/pre&gt;
&lt;br /&gt;
&lt;p&gt;日志文件的大小，单位Byte，&lt;strong&gt;可选设置&lt;/strong&gt;，默认为&lt;strong&gt;1GiB&lt;/strong&gt;，超过该大小后日志将被转储&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;log_size = 1073741824&lt;/code&gt;&lt;/pre&gt;
&lt;br /&gt;
&lt;p&gt;保留日志文件的个数，&lt;strong&gt;可选设置&lt;/strong&gt;，默认为&lt;strong&gt;16&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;以nameserver为例，所有日志文件保存在work_dir/logs目录，正在写的文件是nameserver.log。当nameserver.log大小超过log_size时，nameserver.log改名为nameserver.log.%Y%m%d%H%M%S，其中YmdHMS分别代表年月日时分秒。如果nameserver进程启动后写入的log文件数目超过了log_num，则删除最早生成的那个log文件，最后重新打开nameserver.log。需要注意的是，work_dir/logs目录下的日志文件数量可能远大于log_num，log_num控制的是每次nameserver进程生存期内最多产生的log文件数量&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;log_num = 16&lt;/code&gt;&lt;/pre&gt;
&lt;br /&gt;
&lt;p&gt;工作线程数量，&lt;strong&gt;可选设置&lt;/strong&gt;，默认为&lt;strong&gt;8&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;TFS底层网络编程框架采用tbnet库以简化消息的处理。tbnet接收和处理包的过程符合生产者-消费者模型。tbnet网络IO线程收到数据后还原为TFS Message，然后放入一全局工作队列中，有多个消费者线程从全局队列取得Message，执行相应的消息处理函数。thread_count指定消费者线程数量&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;thread_count = 4&lt;/code&gt;&lt;/pre&gt;
&lt;br /&gt;
&lt;p&gt;工作队列大小，&lt;strong&gt;可选设置&lt;/strong&gt;，默认是&lt;strong&gt;10240&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;指定工作队列中最多能存放的TFS Message数目，最小为10240，最大为40960&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;task_max_queue_size = 10240&lt;/code&gt;&lt;/pre&gt;
&lt;br /&gt;
&lt;p&gt;工作目录，&lt;strong&gt;可选设置&lt;/strong&gt;，默认为&lt;strong&gt;/tmp&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;该目录下的logs目录存放日志文件，根据服务的不同，工作目录下还会存储一些持久化数据。因为/tmp下的数据易失，强烈建议改掉默认设置&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;work_dir = /data/tfs&lt;/code&gt;&lt;/pre&gt;
&lt;br /&gt;
&lt;p&gt;网络设备，&lt;strong&gt;必须设置&lt;/strong&gt;&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;dev_name = bond0&lt;/code&gt;&lt;/pre&gt;
&lt;br /&gt;
&lt;p&gt;对外提供服务的IP地址，&lt;strong&gt;必须设置&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;服务配置HA时设置为VIP，没配置HA可以设为master的IP&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;ip_addr = 192.168.0.1&lt;/code&gt;&lt;/pre&gt;
&lt;br /&gt;
&lt;p&gt;监听端口, &lt;strong&gt;必须设置&lt;/strong&gt;，从1024~65535中选取&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;port = 8108&lt;/code&gt;&lt;/pre&gt;</content>
 </entry>
 
 
</feed>